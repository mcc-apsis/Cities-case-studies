{
    "collab_server" : "",
    "contents" : "rm(list = ls())\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(magrittr)\nlibrary(reshape2)\nlibrary(svglite)\n\nctab <-\n  read.csv(\"Data/cities_places_topics.csv\",sep=\",\",header=TRUE) %>%\n  subset(select=-c(X)) %>%\n  select(cities,year,title,abstract,doi,authors,everything())\n\n#constrain to at least 10 studies per city\nctop <-\n  ctab %>%\n  count(vars=cities) %>%\n  arrange(desc(n)) %>%\n  filter(n>9)\n\n#plot studies by city\ng_count <- ggplot(ctop,aes(x=reorder(vars,-n),y=n)) +\n  geom_bar(stat=\"identity\") +\n  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))\n\n#heatmap of cities and topics\ncht <- data.frame()\nfor (i in 1:length(ctop$vars)){\n  cht <- rbind(cht,ctab[ctab$cities==ctop$vars[i],])\n}\n#check for duplicates\ncht <- cht[!duplicated(cht$UT),]\ncht <- cht[,-c(2:7)]\n#sum correlations\ncht <- tidyr::gather(cht,topic,value,-cities)\nfor (i in 1:length(cht[,1])) {\n  if (cht$value[i]>0.005) {\n    cht$value[i] <- 1\n  }\n  else {\n    cht$value[i] <- 0\n  }\n}\ncht <- cht %>% group_by(cities,topic) %>% summarise_each(funs(sum),value)\nz<-cht %>% group_by(cities) %>% summarise_each(funs(sum),value) %>% arrange(desc(value))\ncht$city_ordered <- factor(cht$cities,levels=z$cities)\n\ng_heat <- ggplot(data = cht, aes(city_ordered,topic)) +\n  geom_tile(aes(fill = value),colour = \"white\") +\n  scale_fill_gradient(low = \"white\",high = \"steelblue\") +\n  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))\n\n##\nggsave(file = \"Plots/City_studies.svg\",plot = g_count)\nggsave(file = \"Plots/City_topics.svg\",plot = g_heat)\n",
    "created" : 1511258761730.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "894323604",
    "id" : "CF03095A",
    "lastKnownWriteTime" : 1511347941,
    "last_content_update" : 1511347941405,
    "path" : "C:/Users/lamw/Google Drive/Work/Publications/Cities case studies/R/blarg.R",
    "project_path" : "R/blarg.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}